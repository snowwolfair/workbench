<div class="map-container">
  <!-- <iframe src="http://118.25.113.92:1514/" width="100%" height="100%"></iframe> -->
  <div style="width: 100%">
    <nz-radio-group [(ngModel)]="radioValue" (ngModelChange)="switchGameMode()">
      <label nz-radio-button nzValue="12">12人场</label>
      <label nz-radio-button nzValue="9">9人场</label>
    </nz-radio-group>
    <div>
      <button (click)="startGame()">开始游戏</button>
      <button (click)="resetGame()">重置游戏</button>
    </div>
    <div class="player-container">
      <div class="player-container-wrapper" [ngClass]="{ 'white-background': choosePlayer }">
        <!-- 上排 -->
        <div class="player-row">
          @for (player of topRow; track player.id) {
            <div
              class="player"
              [ngClass]="{ 'choose-player': choosePlayer && player.isAlive, death: !player.isAlive && showOverlay }"
              (click)="getPlayer(player.id)"
            >
              <div
                class="player-img"
                [ngStyle]="{
                  height: showPlayerRole ? '80%' : '100%',
                  'border-color': player.isAlive ? '#000000' : '#ff0000'
                }"
              >
                {{ player.name }}
              </div>
              @if (!showPlayerRole) {
                <div class="player-role" [ngClass]="{}"> {{ player?.jumpRole ? (player.jumpRole | i18n) : '&nbsp;' }} </div>
              }
              @if (showPlayerRole) {
                <div class="player-role" [ngClass]="{}"> {{ player?.jumpRole | i18n }} | {{ player.role | i18n }} </div>
              }
            </div>
          }
        </div>

        <!-- 下排 -->
        @if (bottomRow.length > 0) {
          <div class="player-row">
            @for (player of bottomRow; track player.id) {
              <div
                class="player"
                [ngClass]="{ 'choose-player': choosePlayer && player.isAlive, death: !player.isAlive && showOverlay }"
                (click)="getPlayer(player.id)"
              >
                <div
                  class="player-img"
                  [ngStyle]="{
                    height: showPlayerRole ? '80%' : '100%',
                    'border-color': player.isAlive ? '#000000' : '#ff0000'
                  }"
                >
                  {{ player.name }}
                </div>
                @if (!showPlayerRole) {
                  <div class="player-role" [ngClass]="{}"> {{ player?.jumpRole ? (player.jumpRole | i18n) : '&nbsp;' }} </div>
                }
                @if (showPlayerRole) {
                  <div class="player-role" [ngClass]="{}"> {{ player?.jumpRole | i18n }} | {{ player.role | i18n }} </div>
                }
              </div>
            }
          </div>
        }
        @if (showModel) {
          <div>{{ talk }} </div>
        }
      </div>
    </div>
    <div class="control-extra">
      <button (click)="switchRole()">菜单</button>
      <button (click)="showGameLog()">游戏日志</button>
      <button (click)="showSystemLog()">系统日志</button>
    </div>
    @if (showOverlay) {
      <div class="global-overlay" (click)="onOverlayClick($event)"></div>
    }
    <div class="down-part">
      @if (showControl) {
        <div class="control">
          <button class="control-cell mar-left">
            <span class="control-cell-text" style="margin-right: -10px">{{ currentPlayer?.name }}</span>
          </button>
          @for (option of controlOptions; track option.value) {
            <button
              class="control-cell"
              [ngStyle]="{ 'margin-left': option.value !== 1 ? '0px' : '-10px' }"
              (click)="onControlClick(option)"
              [disabled]="setDisabled(option)"
            >
              <span class="control-cell-text">{{ option.label }}</span>
            </button>
          }
        </div>
      }

      @if (showModel) {
        <div class="model" (click)="nextSentence()">
          <div id="sentenceDisplay" class="sentence-text">
            @for (char of characters; track $index) {
              <span [ngClass]="{ 'show-character': char.visible, 'sentence-character': !char.visible }">{{ char.value }}</span>
            }
          </div>
        </div>
      }
    </div>
  </div>
</div>

<nz-modal
  [nzVisible]="gameLogVisible"
  [nzContent]="gameLogContent"
  nzTitle="{{ '游戏日志' | i18n }}"
  [nzFooter]="null"
  (nzOnCancel)="handleCancelGameLog()"
  nzClosable="true"
  [nzWidth]="800"
>
</nz-modal>

<ng-template #gameLogContent>
  <div style="overflow: auto; height: 400px">
    @for (log of gameLogs; track $index) {
      <div>{{ log }}</div>
    }
  </div>
</ng-template>

<nz-modal
  [nzVisible]="systemLogVisible"
  [nzContent]="systemLogContent"
  nzTitle="{{ '系统日志' | i18n }}"
  [nzFooter]="null"
  (nzOnCancel)="handleCancelSystemLog()"
  nzClosable="true"
  [nzWidth]="800"
>
</nz-modal>

<ng-template #systemLogContent>
  <div style="overflow: auto; height: 400px">
    @for (log of systemLogs; track $index) {
      <div>{{ log }}</div>
    }
  </div>
</ng-template>
